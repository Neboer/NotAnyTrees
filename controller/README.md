# 砍树行为指南

## 砍树逻辑
机器人砍树遵循如下逻辑：
1. 平地找树，以下都是对一棵树做操作的逻辑。
2. 寻路，走到距离树干1格相邻的位置上。如果位置有树叶/泥土就打掉，树苗绝不能打，树干尽量别打。（A\*权重） 
3. 挖去相邻自己的两块树干，走到刚刚挖去的位置上（算作寻路的逻辑）。 
4. 尽可能多的挖去该树的树干和位于树干正下方的的所有方块。 
5. 如所有的树干和位于树干正下方的的所有方块还存在，则跳起并用草方块垫高自己，直到头顶被树干挡住。反复执行此句直到全部挖完。
6. 从上到下地挖去脚下的草方块，直到抵达地面。
7. 如有树苗则补种树苗，如没有则等待种植。
8. 捡起所有掉落物，开始下一个工作循环（等待树叶自然凋零）。

## 寻路逻辑
机器人用带权A\*找到合适的路径之后，就会沿着这条路径走。当blockUpdate发生在机器人的目标路线上的时候，
除非更新的原因是机器人打掉了目标方块，否则需要重新执行方法寻找最佳路线。

机器人的寻路行动由走路和挖掘组成。R\*计算完成后，计算结果会被制成一系列的指令，机器人按照顺序执行，直到迫近目标。
机器人会优先走到障碍物附近，然后尽可能挖掘所有障碍方块。然后重复这一过程。机器人会把两个树干方块也当作障碍物打掉。

## 三层控制逻辑
机器人受 寻路、砍树、种树、回地面、吃东西、制作物品、存入箱子 七个高级控制器来控制。每个时刻只能有一个高级控制器来控制机器人的行为。
高级控制器通过控制低级的actions来完成任务。

这四个高级控制器受到中央控制器统一调度。中央控制器一般不会轻易打断高级控制器，除了寻路。如果机器人在寻路的过程中发现有方块出现在
自己要走的路线上，那么中央控制器就会打断寻路，并重新寻路，只不过寻路的目标不会变。

打断控制器用到了bluebird库的promise。

1级控制器：Grab Dig WalkTo Jump Place Eat Craft SubmitToChest

2级控制器：PathFind CutTree PlantSapling DownToGround _Eat Craft SubmitToChest_

3级控制器：CentralController

## 识别一棵已被破坏的树
机器人为了寻路，有的时候需要破坏一棵树的方块，不过机器人并不会因此就忽略这棵树不去砍它。因为机器人在来到树场后，
会记录所有“树干”和树苗的位置，机器人砍完一棵树之后，会直接种植树苗。这些树的位置被存于程序中，只要在目标位置
的一定高度上存在树干，就会被标记为一棵树。
